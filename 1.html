<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Pics Extractor</title>
  <a href="index.html">Discount & Sale Price </a>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.0/jszip.min.js"></script>
</head>
<body style="direction: rtl; font-family: Arial; padding: 20px">

  <h2>Pics Links</h2>
  <textarea id="links" rows="10" cols="50" placeholder="https://example.com/image1.jpg"></textarea><br><br>

  <label for="startNum">ابدأ الترقيم من:</label>
  <input type="number" id="startNum" value="1" style="width:80px; margin-right:10px;"><br><br>

  <button onclick="downloadAndZip()">Download</button>

  <p id="status" style="color: green; margin-top: 10px;"></p>

  <script>
    async function downloadAndZip() {
      const textarea = document.getElementById('links');
      const status = document.getElementById('status');
      const startNumInput = document.getElementById('startNum');
      const urls = textarea.value.trim().split('\n').filter(Boolean);
      let startNum = parseInt(startNumInput.value) || 1;

      if (urls.length === 0) {
        status.textContent = 'أضف روابط الصور أولاً';
        return;
      }

      status.textContent = 'الرجاء الانتظار...';

      const zip = new JSZip();

      for (let i = 0; i < urls.length; i++) {
        const url = urls[i];
        try {
          const response = await fetch(url);
          const blob = await response.blob();
          const ext = url.split('.').pop().split('?')[0]; // استخراج الامتداد
          zip.file(`${startNum}.${ext}`, blob);
          startNum++;

          status.textContent = `يتم تحميل ${i + 1} من ${urls.length}... ⌛`;

        } catch (error) {
          console.error(`فشل التحميل: ${url}`, error);
          status.textContent = `خطأ في تحميل ${i + 1}/${urls.length}`;
        }
      }

      status.textContent = 'جاري تجهيز الملف المضغوط...';

      const zipFile = await zip.generateAsync({ type: "blob" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(zipFile);
      link.download = "images.zip";
      link.click();

      status.textContent = 'تم التحميل بنجاح ✅';
    }
  </script>
</body>
</html>
